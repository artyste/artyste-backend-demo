{% load static %}
<!DOCTYPE html>
<html>
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
{#<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>#}
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
            crossorigin="anonymous"></script>

<script src="https://kit.fontawesome.com/f2b0b62507.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css"
          integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">


<script src="https://nosir.github.io/cleave.js/dist/cleave.min.js" crossorigin="anonymous"></script>


{% if page == 'checkout' %}
    <script src="https://cdn.jsdelivr.net/npm/maska@latest/dist/maska.js"></script>
{% endif %}



    <link rel="icon" href="{% static '/favicon/favicon.ico' %}">

    {% block header %}
    {% endblock %}

<style>
    [v-cloak] .v-cloak--block {
        display: block;
    }

    [v-cloak] .v-cloak--inline {
        display: inline;
    }

    [v-cloak] .v-cloak--inlineBlock {
        display: inline-block;
    }

    [v-cloak] .v-cloak--hidden {
        display: none;
    }

    [v-cloak] .v-cloak--invisible {
        visibility: hidden;
    }

    .v-cloak--block,
    .v-cloak--inline,
    .v-cloak--inlineBlock {
        display: none;
    }
</style>

</head>
<body>

<div id="app">

{% if user.is_authenticated %}
    {% if perms.art %}
        {% if perms.art.add_product %}
            <div class="alert alert-success p-1  mb-0" role="alert">
                Logged as Artist
            </div>
        {% endif %}
        {% if perms.art.add_gallery %}
            <div class="alert alert-secondary p-1 mb-0" role="alert">
                Logged as Curator
            </div>
        {% endif %}
    {% else %}
        <div class="alert alert-warning  p-1 mb-0" role="alert">
            Logged as User / Customer
        </div>
    {% endif %}
{% endif %}



  <header class="p-3 bg-gray-dark ">
    <div class="container">
      <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
        <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-decoration-none">
{#            <img class="navbar-brand" src="{% static 'images/arthology_logo.svg' %}" alt="" height="40" />#}
            <img class="navbar-brand" src="{% static 'images/artyste_logo.svg' %}" alt="" height="40" />
        </a>


                        <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                <li class="nav-item">
                    <a class="nav-link text-light" aria-current="page" href="{% url 'home' %}">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" aria-current="page" href="{% url 'galleries' %}">Galleries</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" aria-current="page" href="#">Artists</a>
                </li>
            </ul>

          {% if user.is_authenticated %}
              <div class="text-end d-flex">

                  <div class="btn-group me-2">
                      <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown"
                              aria-expanded="false">
                          <i class="fa fa-user"></i>
                      </button>
                      <ul class="dropdown-menu dropdown-menu-end pt-2">
                          <li><a class="dropdown-item" href="{% url 'artworks' %}"><i class="fa fa-palette me-2"></i>My Arts</a></li>
                          <li><a class="dropdown-item" href="#"><i class="fa fa-user-edit me-2"></i>My Account</a></li>
                          <li><a class="dropdown-item" href="{% url 'logout' %}"><i class="fa fa-sign-out-alt me-2"></i>Logout</a></li>
                      </ul>
                  </div>

                  <div class="btn-group me-2">
                      <button type="button" class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown"
                              aria-expanded="false">
                          <img src="{% static 'images/circle.svg' %}" height="25px"/>
                          {% if circle %}US$ {{ circle }}{% endif %}
                      </button>
                      <ul class="dropdown-menu dropdown-menu-end pt-2">
                          <li><a class="dropdown-item" href="{% url 'profile-wallet' %}"><i class="fa fa-wallet me-2"></i> My Wallet</a></li>
                          <li><a class="dropdown-item" href="#"><i class="fa fa-money-check-alt me-2"></i>Add Funds</a></li>
                      </ul>
                  </div>

                    <div v-cloak>
                  <span class="v-cloak--inline">
                      <button class="btn btn-secondary" type="button" disabled>
  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
  <span class="visually-hidden">Loading...</span>
</button>
                </span>

                  <span v-show="!connected" >
                      <a v-on:click="metaConnect" class="btn btn-outline-secondary v-cloak--hidden">
                          <img class="me-2" src="{% static 'images/phantom_black.svg' %}" height="25px"/>
                           Connect
                      </a>
                </span>

                  <span v-show="connected" >
                     <a v-on:click="metaConnect" class="btn btn-outline-secondary v-cloak--hidden">
                          <img class="me-2" src="{% static 'images/phantom_black.svg' %}" height="25px"/>
                           [[ account ]]
                      </a>
                     </span>
                    </div>


              </div>
          {% else %}
              <a class="btn btn-secondary" role="button" href="{% url 'register' %}">Create Account</a>
              <a class="btn btn-outline-secondary ms-2" role="button" href="{% url 'login' %}">Login</a>
          {% endif %}

      </div>
    </div>
  </header>




    {% block body %}
    {% endblock %}

    {% block footer %}
    {% endblock %}


</div>

{% if page == 'checkout' %}<script src="https://unpkg.com/openpgp@5.0.0-6/dist/openpgp.min.js"></script>{% endif %}

<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js" type="application/javascript"></script>
<script>

        {#import * as web3 from 'https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js';#}
        console.log(solanaWeb3);


            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }

            const csrftoken = getCookie('csrftoken');

            {% if page == 'mint' %}
                {#const provider = new ethers.providers.Web3Provider(window.ethereum)#}
                {#const signer = provider.getSigner()#}
                const imgurl = 'https://bafkreif4rzclduw5zu6d4uswwg6o5jzchk4zxmqcbwl5j6trrhpv24qpfu.ipfs.dweb.link/';
                {#const contractABI = '[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"baseURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"recipient","type":"address"},{"internalType":"string","name":"tokenURI","type":"string"}],"name":"mintNFT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"}]';#}
                {#const contractAddress = "0x4C4a07F737Bf57F6632B6CAB089B78f62385aCaE";#}
                {#const contract = new ethers.Contract(contractAddress, contractABI, signer);#}
            {% endif %}
{##}
{#            ethereum.on('chainChanged', (chainId) => {#}
{#                console.log(chainId);#}
{#                app.contchainChange(chainId);#}
{#                window.location.reload();#}
{#            });#}
{##}
{#            ethereum.on('accountsChanged', (accounts) => {#}
{#                console.log(accounts);#}
{#                app.metaConnect();#}
{#            });#}
{##}
{#            ethereum.on('connect', (connectInfo) => {#}
{#                console.log(connectInfo);#}
{#            });#}
{##}
{##}


        var app = new Vue({
            delimiters: ['[[', ']]'],
            el: '#app',
            data: {
                accounts: [],
                account: '',
                connected: false,
                chainID: '',
                balance: null,
                auth: {% if user.is_authenticated %} true {% else %} false {% endif %},
                ethusd: null,

                {% if page == 'productdetail' %}
                    mintingstatus: {{ product.mintingstatus }},
                    mintingtx: {% if product.mintingtx %}{{ product.mintingtx }}{% else %}null{% endif %},
                    mintinghash: '{% if product.mintinghash %}{{ product.mintinghash }}{% endif %}',
                    mintingid: {% if product.mintingid %}{{ product.mintingid }}{% else %}null{% endif %},
                    mintingexplorer: 'https://ropsten.etherscan.io/token/{% if product.mintinghash %}{{ product.mintinghash }}{% endif %}?a={% if product.mintingid %}{{ product.mintingid }}{% endif %}',
                {% endif %}

                {% if page == 'mint' %}
                    message: 'Connect your wallet to get start!',
                    provider: false,
                    tx: null,
                    imgcid: '{{ product.filehash }}',
                    imgcidurl: 'https://{{ product.filehash }}.ipfs.dweb.link/',
                    art_name: '{{ product.title }}',
                    art_Artist: '{{ product.artist.first_name }} {{ product.artist.last_name }}',
                    meta_cid: null,
                    minting: 0,
                {% endif %}


                {% if page == 'checkout' %}
                    creditCardNumber: null,
                    creditCardNumberRaw: null,
                    creditCardNumberFlag: 0,
                    creditCardNumberErro: false,
                    creditCardNumberValid: false,
                    creditCardEncrypted:null,

                    creditCardName: null,
                    creditCardNameValid: false,

                    creditCardDate: null,
                    creditCardDateRaw: null,
                    creditCardNameDate: false,

                    creditCardCvv: null,
                    creditCardCvvValid: false,

                    creditCardDateValid: false,

                    creditCardTotal: 100.50,
                    creditCardToEncrypt: {
                        number: null,
                        cvv: null,
                    },
                    publicKey: 'LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUVOQkY0YzhWZ0JDQUM4QnN6WElCTytiZDZ4VnhLMUdlc3hLK2sybnlpamZ0NDdWa2xnbU80VmpTSmMzQS8yCkljeDNyWFR3S0ZIV282ckJBVUduSVhoK2ZYKzIwZGYwbld6WlNvN3ZNK0ZpMTMzVlpuTG0zalk4cVozdnR5WEMKenhqZnJ5UnlDSncrMlh6cnRGVklYT0RLSEd0RjhUSXZFNUdjdVMxclNmMGlsVUtzOWxUdXlOTEx1bXZJQ2RTeQpCMWQ3MUVCM3VDMUJpekRtaWplMHNFbjB0QXBGS3V0ZnB5aWtsbTZwWm9zWnVnYVUzL1Z3NWNkQTU5VlhHWnFpCjNTWGdzeHU1RE4zc21TU3ZVVkthMUtQd3hackZRZHQ2a3lOVUFuR0lRS3d4b3BjejAyY255R3JvZEdGU3c5TC8KbzlmeHo3Q3FpcnJvL3F6VjJzQmxFMkRvZWVLY09ZVTlzVHRCQUJFQkFBRzBCa05wY21Oc1pZa0JWQVFUQVFnQQpQaFloQlBTc3RXN3o4TkgrWVQ1MGE3S1dkbkdNTUlYQUJRSmVIUEZZQWhzREJRazRaQWtBQlFzSkNBY0NCaFVLCkNRZ0xBZ1FXQWdNQkFoNEJBaGVBQUFvSkVMS1dkbkdNTUlYQXhSQUgvM2xVL1hJbEkrZG5PR2pGRHJCTHMzcUYKN1grV0xsSU5YRmlaNWFuRC9ySnRUbGptb2R2dkhSSmlJTm1GcTRrNi90MURqcTJsdWpXTTFIUmJIaUtxTE56dQovWVJNNG5aL1lGUUd2YktqY3dNWHJDZ1Y1UFNESjZJdTE3MW4vdFFrYXFmRzd0M2ZXQzQzek10VFM4YnV6ZEtGCkQ1ai9yd0VkUjhhOXlsc0luWDdPZXlqekpUeENjQm1udmE1LzhZRFF4NFd4bk1WQWJ4ZnRRSjJzUXNJa0pNQ2MKV1d0TVZwZWlSSExlbWg1cnNhWnBnSkZ5cW1QODJXaDd0aGRkWHd3eVFGcHVUc2x6b1VKMmJaakZyMUxDSjBxRQp3MVJBOFVHaWhPUFB2SVprc2RvdFVDVDhoeXJPYU9GbUtDVUhhV0FQYzRDT3NzdVJpMU5VSGpJUVA0bVUyU0M1CkFRMEVYaHp4V0FFSUFMZFhXTUJaODlQZHFrSVRPWWZlL1pZZko4c2Nudk1PdlovQW1Vb3JpakM4M1VMdjVLbWsKSGpjVXJTR0pFYkpOdDl2NWVpc2RGOFRDNzVwZmhBLzZiOHZCUTVoMU0yT0FoUklYZGlJY1hLaTJyTXhINU9jWQo2YWFkWlVIRFIrYUZWRmtWdm53UnkxVFRDOFNleWs5UDRtd2lrTzl2RGlpMmU1SFl0R1pQcUVEWXVRN05pQnM2CktMRWpHclMwWFpieHg4WVk5enRRTUZKc2ZjdXRJd2lvTy9HcU1ZMFRKdkI0QnVJWTh2TjhPTnVubHZjb2JBYS8KcVRpYVFUcE93T3g2eElPbHB0TkFST1pncUNPZEk2R2NqMjRZRmcycEV4d0h0SjBXOFJpRDBpNEJJU0tEYkZEVAovWmlkMkptZW9vdG0vZXpaNUlDSUZNNk1wOEhDTjB6eWFSMEFFUUVBQVlrQlBBUVlBUWdBSmhZaEJQU3N0Vzd6CjhOSCtZVDUwYTdLV2RuR01NSVhBQlFKZUhQRllBaHNNQlFrNFpBa0FBQW9KRUxLV2RuR01NSVhBdmVJSC9BM1IKOTdlSENUOHdlOUFDUXkxcDJmNk41UFd6QWRaTUtQNm9QTXhpNFlCVUoyK1orNDVibnB2a0ZSdllMVjNwVFRIRApEY0N5cWh4Z0cxdEVGaVUyclZINlFzRStnWldYZkJPZU1lWHhqRkt0U0lzNktQUWViVlMrUHJhOHljK3RPakxOCkZsNlFCRjNGcGJ3YmE5L1pPbk1rbW9yTE1IV241RnJOVy9aZnVLdzhTMHFGQ29nUVNxUUVpbjZnQ0ZEd0gzK0QKQ2JzcDVKMm4xN1pncjBpcGRRYjk4MDJ1bXdDVG9aVGtwL0pwb2t4YzJTZlczaG0xUEc4M1NPUGdMUll0a3JuTApRbURYSmtDdEN6amN3eGQwdnJpVzM4Y29zQko1aVN4WHU5MEZHRWZaaGQ1Y0o4cFpKSkd2VGMrMyt6eE1sWU1HCnZmUjNvUFFoWmtwT2NyRUhlajA9Cj1BT0QzCi0tLS0tRU5EIFBHUCBQVUJMSUMgS0VZIEJMT0NLLS0tLS0K',
                    keyId: 'key1',
                {% endif %}




            },
            created: function () {

                this.getEthUsd();

                {% if user.is_authenticated %}
                    {% if user.wallet_hash %}
                        this.metaConnect();
                    {% endif %}
                {% endif %}

                {% if product %}
                    if (this.mintingstatus === 1) {
                        this.tx_get();
                    }
                {% endif %}



            },
                mounted: function () {


                        this.timer = setInterval(() => {
                            {% if page == 'productdetail' %}
                            if (this.mintingstatus === 1) {
                                this.tx_get();

                            }
                            {% endif %}
                            this.ethusd = this.getEthUsd();
                        }, 30000)

        },
            methods: {
                metaConnect: async function () {
                    console.log('----------------------');
                    this.accounts = await window.solana.connect();
                    console.log(this.accounts);
                    await this.connect();
                },
                connect: async function () {

                    this.connected = true;
                    this.account = this.accounts.publicKey?.toString().slice(0, 4) + '...' + this.accounts.publicKey?.toString().slice(-4);

                },
                contchainChange: function (chainId) {
                    {#console.log(chainId);#}
                    {#this.chainID = chainId;#}
                },

                getEthUsd: async function () {
                    fetch('https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd')
                        .then(response => {
                            response.json().then(async data => {
                                this.ethusd = data['ethereum']['usd'];

                                {% if page == 'checkout' %}
                                {% if product.fiat == 0 %}
                                    this.creditCardTotal = this.EthToUsd({{ product.price }}).toFixed(2);
                                {% else %}
                                    this.creditCardTotal = ({{ product.price }}).toFixed(2);
                                {% endif %}
                                {% endif %}

                            })
                        });
                },
                EthToUsd:  function (eth) {
                    return eth * this.ethusd;
                },
                FormatedEthToUsd:  function (eth) {

                    const formatter = new Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: 'USD',

                    });
                    return formatter.format(eth * this.ethusd);

                },
                UsdToEth:  function (usd) {
                    return usd / this.ethusd;
                },
                FormatedUsdToEth:  function (usd) {
                    return (usd / this.ethusd).toFixed(4);
                },

                {% if page == 'productdetail' %}
                    tx_get: async function () {
                        data = '{"jsonrpc":"2.0","method":"eth_getTransactionReceipt","params": ["{{ product.mintingtx }}"],"id":1}';
                        fetch("https://ropsten.infura.io/v3/613d46b23c354abeafc7aa755c21c3a6", {
                            method: 'POST',
                            body: data,
                            headers: {'Content-Type': 'application/json',},
                        })
                            .then(response => {
                                response.json().then(async data => {

                                    this.mintingstatus = 2;
                                    this.mintinghash = data['result']['to'];
                                    this.mintingid = parseInt(data['result']['logs'][0]['topics'][3]);
                                    this.mintingexplorer = 'https://ropsten.etherscan.io/token/' + this.mintinghash + '?a=' + this.mintingid;

                                    console.log(this.mintingid);
                                    console.log(this.mintinghash);

                                    fetch("{% url 'artworks-detail' pk=product.id %}", {
                                        method: 'POST',
                                        body: JSON.stringify({
                                            'hash': data['result']['to'],
                                            'id': parseInt(data['result']['logs'][0]['topics'][3]),
                                        }),
                                        headers: {
                                            'Accept': 'application/json, text/plain, */*',
                                            'Content-Type': 'application/json',
                                            "X-CSRFToken": csrftoken,
                                        },
                                    });

                                })
                            })
                    },
                {% endif %}

                {% if page == 'mint' %}
                    Transaction: async function () {



                        const meta_json = {
                            "name": '{{ product.title }}',
                            "image": 'https://{{ product.filehash }}.ipfs.dweb.link/',
                            "description": '{{ product.description }}',
                        };

                        fetch("https://api.nft.storage/upload", {
                            method: 'POST',
                            body: JSON.stringify(meta_json),
                            headers: {
                                'accept': 'application/json',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJkaWQ6ZXRocjoweEY0OEI2NjBkMUQ3MEZGNDk1MjYzNjZDMkNDZERFNTExMzZFNWQ1NDEiLCJpc3MiOiJuZnQtc3RvcmFnZSIsImlhdCI6MTYyODY2NzY0NjE4NywibmFtZSI6IlRlc3QifQ.MVf1uJHqsLPX6HTnZRrSi4VZYfJyS7zS1hNTiqCMUpg',
                                'Content-Type': 'application/json',
                            },
                        })
                            .then(response => {

                                response.json().then(async data => {
                                    this.meta_cid = data['value']['cid'];

                                    const metadata = 'https://' + data['value']['cid'] + '.ipfs.dweb.link';
                                    console.log(metadata);


                                    {#fetch("{% url 'artworks-mint-sol' pk=product.id %}", {#}
                                    {#    method: 'POST',#}
                                    {#    body: JSON.stringify({#}
                                    {#        'metadata': metadata,#}
                                    {#        'pk': {{ product.id }},#}
                                    {#    }),#}
                                    {#    headers: {#}
                                    {#        'Accept': 'application/json, text/plain, */*',#}
                                    {#        'Content-Type': 'application/json',#}
                                    {#        "X-CSRFToken": csrftoken,#}
                                    {#    },#}

                                    {#window.location.href = "{% url 'artworks-detail' pk=product.id %}";#}

                                    {##}
                                    {##}
                                    {#                            await contract.mintNFT(this.accounts[0], metadata).then( res => {#}
                                    {#                                console.log(res);#}
                                    {#                                console.log(res.hash);#}
                                    {##}
                                    {#                                fetch("{% url 'artworks-mint' pk=product.id %}", {#}
                                    {#                                    method: 'POST',#}
                                    {#                                    body: JSON.stringify({#}
                                    {#                                        'tx': res.hash.toString(),#}
                                    {#                                        'pk': {{ product.id }},#}
                                    {#                                    }),#}
                                    {#                                    headers: {#}
                                    {#                                        'Accept': 'application/json, text/plain, */*',#}
                                    {#                                        'Content-Type': 'application/json',#}
                                    {#                                        "X-CSRFToken": csrftoken,#}
                                    {#                                    },#}
                                    {#                                });#}
                                    {#                                window.location.href = "{% url 'artworks-detail' pk=product.id %}";#}
                                    {#                                });#}
                                    {##}
                                    {##}


                                });

                            })

                        if (this.meta_cid) {
                            const metadata = 'https://' + this.meta_cid + '.ipfs.dweb.link/';
                            console.log(metadata)
                        }
                    },

                    TransactionSol: async function () {

                        const connection = new solanaWeb3.Connection('https://api.devnet.solana.com', 'confirmed');

                        this.minting = 1;

                        const transaction = new solanaWeb3.Transaction().add(
                            solanaWeb3.SystemProgram.transfer({
                                fromPubkey: window.solana.publicKey,
                                toPubkey: 'DGLyGabZHc2Xb7znZD9FiQouYjtb52dgeZEcGY37uvng',
                                lamports: 100000000,
                            })
                        );
                        transaction.feePayer = window.solana.publicKey;
                        transaction.recentBlockhash = (
                            await connection.getRecentBlockhash()
                        ).blockhash;

                        if (transaction) {
                            try {
                                let signed = await window.solana.signTransaction(transaction);
                                this.minting = 1;
                                console.log("Got signature, submitting transaction");

                                let signature = await connection.sendRawTransaction(signed.serialize());
                                this.minting = 2;

                                await connection.confirmTransaction(signature).then(() => {
                                    console.log("Transaction Succeed!");
                                    this.minting = 10;

                                    const meta_json = {
                                        "name": '{{ product.title }}',
                                        "image": 'https://{{ product.filehash }}.ipfs.dweb.link/',
                                        "description": '{{ product.description }}',
                                    };


                                    fetch("https://api.nft.storage/upload", {
                                        method: 'POST',
                                        body: JSON.stringify(meta_json),
                                        headers: {
                                            'accept': 'application/json',
                                            'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJkaWQ6ZXRocjoweEY0OEI2NjBkMUQ3MEZGNDk1MjYzNjZDMkNDZERFNTExMzZFNWQ1NDEiLCJpc3MiOiJuZnQtc3RvcmFnZSIsImlhdCI6MTYyODY2NzY0NjE4NywibmFtZSI6IlRlc3QifQ.MVf1uJHqsLPX6HTnZRrSi4VZYfJyS7zS1hNTiqCMUpg',
                                            'Content-Type': 'application/json',
                                        },
                                    }).then(response => {

                                        response.json().then(async data => {
                                            this.minting = 40;
                                            this.meta_cid = data['value']['cid'];

                                            const metadata = 'https://' + data['value']['cid'] + '.ipfs.dweb.link';
                                            console.log(metadata);


                                            console.log('MINTING - Creating Token -----------');
                                            fetch("{% url 'artworks-mint-token-sol' %}", {
                                                method: 'POST',
                                                body: JSON.stringify({
                                                    'metadata': metadata,
                                                    'pk': {{ product.id }},
                                                }),
                                                headers: {
                                                    'Accept': 'application/json, text/plain, */*',
                                                    'Content-Type': 'application/json',
                                                    "X-CSRFToken": csrftoken,
                                                },
                                            }).then(response => {

                                                response.json().then(async data => {
                                                    this.minting = 70;
                                                    console.log(data)
                                                    console.log('MINTING - Creating NFT --------');

                                                    fetch("{% url 'artworks-mint-metadata-sol' %}", {
                                                        method: 'POST',
                                                        body: JSON.stringify({
                                                            'metadata': metadata,
                                                            'pk': {{ product.id }},
                                                            'sing_account': this.accounts.publicKey?.toString(),
                                                        }),
                                                        headers: {
                                                            'Accept': 'application/json, text/plain, */*',
                                                            'Content-Type': 'application/json',
                                                            "X-CSRFToken": csrftoken,
                                                        },
                                                    }).then(response => {

                                                        response.json().then(async data => {
                                                            this.minting = 100;
                                                            console.log(data)
                                                            console.log('MINTING - Done --------');
                                                            window.location.href = "{% url 'artworks-detail' pk=product.id %}";

                                                        });

                                                    });


                                                });

                                            });


                                        });

                                    })


                                });

                            } catch (err) {
                                console.log(err)
                                this.minting = 0;
                            }

                        };


                    },

            fpost: function () {
                    fetch("{% url 'artworks-mint' pk=product.id %}", {
                        method: 'POST',
                        body: JSON.stringify({
                            'tx': 1,
                            'pk': {{ product.pk }},
                        }),
                        headers: {
                            'Accept': 'application/json, text/plain, */*',
                            'Content-Type': 'application/json',
                            "X-CSRFToken": csrftoken,
                        },
                    });
                    {#window.location.href = "{% url 'artworks-detail' pk=product.id %}";#}
            },

                {% endif %}
                {% if page == 'checkout' %}
                    checkout_post: async function () {


                        fetch("{% url 'checkout' pk=product.id %}", {
                            method: 'POST',
                            body: JSON.stringify({
                                'cardName': this.creditCardName,
                                'cardTotal': this.creditCardTotal,
                            }),
                            headers: {
                                'Accept': 'application/json, text/plain, */*',
                                'Content-Type': 'application/json',
                                "X-CSRFToken": csrftoken,
                            },
                        });
                    },
                    EncryptData: async function (dataToEncrypt, dataPublicKey) {
                        const decodedPublicKey = atob(dataPublicKey);
                        const publicKey = await openpgp.readKey({armoredKey: decodedPublicKey});
                        const CardDetailsStringify = JSON.stringify(dataToEncrypt);
                        const encrypted = await openpgp.encrypt({
                            message: await openpgp.createMessage({text: CardDetailsStringify}),
                            encryptionKeys: publicKey
                        });
                        return await btoa(encrypted);
                    },
                    checkForm: async function () {
                        {#console.log('click');#}
                        {#this.creditCardEncrypted = await this.EncryptData(this.creditCardToEncrypt, this.publicKey);#}
                        {#console.log(this.creditCardEncrypted);#}
                        {#e.preventDefault();#}
                    },
                {% endif %}


            },

            watch: {
                {% if page == 'checkout' %}
                creditCardCvv: async function (value) {
                    this.creditCardToEncrypt.cvv = value;
                    {#console.log(this.creditCardToEncrypt);#}
                    if (value.toString().length >= 3) {
                        this.creditCardCvvValid = true;
                        this.creditCardEncrypted = await this.EncryptData(this.creditCardToEncrypt, this.publicKey);
                    } else {
                        this.creditCardCvvValid = false;
                    }
                },
                creditCardName: function (value) {
                    if (value !== '') {
                        this.creditCardNameValid = true;
                    } else {
                        this.creditCardNameValid = false;
                    }
                },
                creditCardNumber: async function (value) {
                    this.creditCardNumberRaw = value.replace(/\s/g, "");
                    this.creditCardToEncrypt.number = value.replace(/\s/g, "");
                    {#console.log(this.creditCardToEncrypt);#}

                    if (value.toString()[0] === '4') {
                        this.creditCardNumberFlag = 1;

                    } else if (value.toString()[0] === '5') {
                        this.creditCardNumberFlag = 2;
                    } else {
                        this.creditCardNumberFlag = 0;
                    }
                    if (this.creditCardNumberRaw.toString().length === 16) {
                        if (this.creditCardNumberFlag !== 0) {
                            this.creditCardNumberErro = false;
                            this.creditCardEncrypted = await this.EncryptData(this.creditCardToEncrypt, this.publicKey);
                            this.creditCardNumberValid = true;
                        } else {
                            this.creditCardNumberErro = true;
                        }
                    } else {
                        this.creditCardNumberValid = false;
                    }
                }
            {% endif %}
            }
        });
        </script>

</body>
</html>